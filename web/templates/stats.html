<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin">BI订阅管理</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/admin/subscriptions">订阅管理</a>
                <a class="nav-link active" href="/admin/stats">统计报表</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>统计报表</h2>
        
        <!-- 查询条件 -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">开始时间</label>
                        <input type="date" class="form-control" id="startTime">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">结束时间</label>
                        <input type="date" class="form-control" id="endTime">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">每页条数</label>
                        <select class="form-select" id="pageSize">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <div>
                            <button class="btn btn-primary" onclick="loadStats()">查询</button>
                            <button class="btn btn-secondary" onclick="resetQuery()">重置</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 统计表格 -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>订阅Key</th>
                                <th>版本号</th>
                                <th>调用次数</th>
                                <th>平均执行时间(ms)</th>
                                <th>最短执行时间(ms)</th>
                                <th>最长执行时间(ms)</th>
                                <th>创建人ID</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody">
                            <!-- 数据通过JavaScript加载 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav>
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- 分页按钮通过JavaScript生成 -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        
        // 加载统计数据
        function loadStats(page = 1) {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const pageSize = document.getElementById('pageSize').value;
            
            // 这里应该调用API获取数据，简化实现
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = `
                <tr>
                    <td>house_report</td>
                    <td>1</td>
                    <td>156</td>
                    <td>245.6</td>
                    <td>89</td>
                    <td>1205</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>user_stats</td>
                    <td>1</td>
                    <td>89</td>
                    <td>156.3</td>
                    <td>45</td>
                    <td>890</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>house_report</td>
                    <td>2</td>
                    <td>23</td>
                    <td>189.7</td>
                    <td>67</td>
                    <td>456</td>
                    <td>2</td>
                </tr>
            `;
            
            // 更新分页
            updatePagination(3, page, parseInt(pageSize));
        }
        
        // 更新分页
        function updatePagination(total, current, pageSize) {
            const totalPages = Math.ceil(total / pageSize);
            const pagination = document.getElementById('pagination');
            
            let html = '';
            
            // 上一页
            if (current > 1) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadStats(${current - 1})">上一页</a></li>`;
            }
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                const active = i === current ? 'active' : '';
                html += `<li class="page-item ${active}"><a class="page-link" href="#" onclick="loadStats(${i})">${i}</a></li>`;
            }
            
            // 下一页
            if (current < totalPages) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="loadStats(${current + 1})">下一页</a></li>`;
            }
            
            pagination.innerHTML = html;
            currentPage = current;
        }
        
        // 重置查询条件
        function resetQuery() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startTime').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('endTime').value = today.toISOString().split('T')[0];
            document.getElementById('pageSize').value = '20';
            
            loadStats();
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            resetQuery();
        });
    </script>
</body>
</html>